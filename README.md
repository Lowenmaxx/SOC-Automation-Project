# SOC-Automation-Project

## Objective

The primary objective of this SOC automation project is to gain hands-on experience in setting up, configuring, and operating a Security Operations Center in a simulated environment. Gain familiarity with various open-source tools commonly used in real-world SOCs, including Wazuh for alert generation, Shuffle for Security Orchestration, Automation, and Response (SOAR), and TheHive for case management. This lab aims to simulate cybersecurity incidents to make it possible to practice incident detection, analysis, and response procedures in a controlled setting. This also teaches how to integrate different security tools seamlessly to streamline the incident response process and enhance efficiency. The lab incorporates threat intelligence enrichment capabilities, enabling analysts to enrich Indicators of Compromise (IOCs) using services like VirusTotal.

## Skills Learned

- How to make a network diagram to understand the flow
- How to set up VMs
- Configuring TheHive and Wazuh Server
## Tools Used

- Draw.io: used to make network diagram
- Windows 10 Virtual Machine: Set up a Windows 10 virtual machine to serve as an endpoint for telemetry generation using Sysmon.
- Wazuh Server: Deploy a Wazuh server on a cloud instance to centralize and manage alerts generated by endpoint agents.
- Wazuh Agent: Install the Wazuh agent on the Windows 10 VM to collect telemetry data and forward it to the Wazuh server.
- Shuffle: Implement Shuffle as a SOAR tool to automate response actions based on incoming alerts from Wazuh.
- TheHive: Deploy TheHive for centralized case management, enabling analysts to track and respond effectively to security incidents.
- Mimikatz: to simulate malicious activities on the Windows 10 VM, generating telemetry data captured by Sysmon.

## Steps

### Diagram
Step 1: Make a network diagram using Draw.io.

*Ref 1: Network Diagram*

![SOC-Automation-Project-diagram drawio](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/ffdc172d-ab63-4ce6-976f-038f4773cf66)


### Install tools

Step 1: Install
<a href="https://www.virtualbox.org/"><img src="https://img.shields.io/badge/-VirtualBox-183A61?style=for-the-badge&logo=virtualbox&logoColor=white" /></a> which is needed to make virtual machines (Add which machines later).

Step 2: Install
<a href="https://www.microsoft.com/en-us/software-download/windows10"><img src="https://img.shields.io/badge/-Windows%2010-0078D6?style=for-the-badge&logo=Windows&logoColor=white" /></a> media creation tool to make a ISO image.
Step 3: use the ISO file to make a VM using the Windows 10 ISO image

Step 4: Download
<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon"><img src="https://img.shields.io/badge/-Sysmon-0078D4?style=for-the-badge&logo=Windows&logoColor=white" /></a> and
<a href="https://github.com/olafhartong/sysmon-modular/blob/master/sysmonconfig.xml"><img src="https://img.shields.io/badge/-Sysmon%20Modular-181717?style=for-the-badge&logo=github&logoColor=white" /></a>

Step 5: Open PowerShell in administrator mode. Use cd (directory here) to change the directory to where you have your unzipped sysmon.

Step 6: Move the sysmonconfig.xml to the same folder as the sysmon folder.

Step 7: use the command .\Sysmon64.exe -i .\sysmonconfig.xml in Powershell to install sysmon.

Step 8: Download<a href="https://ubuntu.com/download/desktop"><img src="https://img.shields.io/badge/-Ubuntu%20Desktop-E95420?style=for-the-badge&logo=ubuntu&logoColor=white" /></a> ISO file to make another VM.

Step 9: Follow this guide to install Wazuh <a href="https://www.youtube.com/watch?v=3CfjoCQmpo8"><img src="https://img.shields.io/badge/-YouTube-FF0000?style=for-the-badge&logo=youtube&logoColor=white" /></a>

Step 10: Make another Ubuntu VM and follow These instructions to Download the hive <a href="https://github.com/MyDFIR/SOC-Automation-Project/blob/main/TheHive-Install-Instructions"><img src="https://img.shields.io/badge/-TheHive-181717?style=for-the-badge&logo=github&logoColor=white" /></a>

### Configure TheHive

Step 1: Boot up TheHive VM, open the terminal, and use the command sudo nano /etc/cassandra/cassandra.yaml

Step 2: From here, you can change the name of the cluster and other settings; press ctrl+w to find the listen address and replace localhost with your IP.

Step 3: Hold ctrl+w to find rpc_address(you might have to scroll down to find it) and replace localhost with your IP address.

Step 4: hold ctrl+w to find seed_provider. Where it says seeds: "127.0.0.1:7000" replace 127.0.0.1 with your IP. Then, hit ctrl+x to save the changes.

Step 5: stop cassandra service by using systemctl stop cassandra.service in the terminal.

Step 6: Remove old files by using sudo rm -rf /var/lib/cassandra/*

Step 7: Start Cassandra service by using systemctl start cassandra.service and check it is running by using systemctl status cassandra.service ![image](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/7ebea622-b7f6-44c0-955e-044da8d71f48)

Step 8: do the command sudo nano /etc/elasticsearch/elasticsearch.yml

Step 9: uncomment cluster.name and change the name to thehive.

Step 10: uncomment node.name

Step 11: uncomment network.host and change the IP to your IP. 

Step 12: Next start elasticsearch by using systemctl start elasticsearch.service, then enable it by using systemctl enable elasticsearch.service, and check the status using systemctl status elasticsearch.service ![image](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/d468fcdc-a36b-48aa-9986-e6356631cbbb)


Step 13: we have to make sure thehive has access to the directories it needs we check this by doing ls -la /opt/thp. ![image](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/1a0d53df-75c8-4918-9bd5-4eae0c77d948)

Step 14: To give thehive permissions to the directories it needs we do sudo chown -R thehive:thehive /opt/thp. ![image](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/44aaecc4-45d9-4800-8d43-684217ccca33)

Step 15: It's time to configure thehive itself. Use sudo nano /etc/the hive/application.conf

Step 16: go down to where it says hostname and change the IP to your IP

Step 17: change the cluster-name to the same name you have on Cassandra

Step 18: go down again and change the hostname to your IP.

Step 19: find application.baseUrl and change localhost to your IP

Step 20: Next start thehive by using systemctl start thehive.service, then enable it by using systemctl enable thehive.service, and check the status by using systemctl status thehive.service (If thehive does not start make sure elasticsearch and cassandra are running) ![image](https://github.com/Lowenmaxx/SOC-Automation-Project/assets/112909141/c53772ad-1509-4cd2-99e2-798fa6b49212)

Step 21: Open a browser and go to HTTP://(TheHive IP):9000. You should be able to access thehive. 

Login: admin@thehive.local 

Password: secret

### Wazuh Server Configuration

Step 1: Login to wazuh on the Windows 10 VM

Step 2: Click on Add Agent and select Windows. (We are using a Windows machine for this lab.)

Step 3: Enter the IP address for the wazuh server

Step 4: OPTIONAL make a name for the agent.

Step 5: Copy the command, open PowerShell in admin mode, paste the command, and run it

Step 6: use the command NET START WazuhSvc to start up wazuh agent
